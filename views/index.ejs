<%- include('partials/header.ejs'); -%>

<div class="input-block">

    <input type="text" id="oponent-input" placeholder="Enter your oponent">
    <input type="text" id="character-input" placeholder="Enter your oponents character">

    <button id="character-send">
        Add character
    </button>
</div>  
<pre id="messages"></pre>


<script>

    const oponentNameInput = document.getElementById('oponent-input');
    const characterInput = document.getElementById('character-input');

    const characterSend = document.getElementById('character-send');

    const messages = document.getElementById('messages');

    const ws = new WebSocket('ws://localhost:3000');

    var playerName = "";
    var oponentNames = [];
    var messagesCount = 0;

    

    characterSend.addEventListener('click', () => {
        const val = {
            oponentName: oponentNameInput?.value,
            character: characterInput?.value,
        };

        const form = document.querySelector('.input-block');
        if (form) {
            form.style.display = 'none';
        }

        oponentNames.push(oponentNameInput?.value)

        if (!val) {
            return;
        } else if (!ws) {
            showMessage('No WebSocket connection');
            return;
        }

        ws.send(JSON.stringify(val));
        nameInput.value = '';
        createMessageDiv(val.oponentName, val.character);
        console.log("clicked");
    }); 

    ws.onmessage = (event) => {
        console.log("Broadcast received");
        var object = JSON.parse(event.data);

        // Check if the player is the same as the current player or another player
        if (messagesCount === 0) {
            playerName = object.oponentName;
            messagesCount++;
            console.log(playerName);
        } else if (playerName === object.oponentName) {
            createMessageDiv(object.oponentName, "???????");
        } else {
            createMessageDiv(object.oponentName, object.character);
            oponentNames.push(object.oponentName);
        }
        console.log(oponentNames);
        console.log(playerName);
    };

    function createMessageDiv(oponentName, character) {
    // Create a new div element
    const messageDiv = document.createElement('div');

    // Set the content of the div
    messageDiv.textContent = `${oponentName} - ${character}`;

    // Optionally, add a class for styling
    messageDiv.classList.add('message');

    // Append the new div to the messages container
    messages.appendChild(messageDiv);
}

    function showMessage(message) {
        messages.textContent += `\n${message}`;
    }
</script>

<%- include('partials/footer.ejs'); -%>
